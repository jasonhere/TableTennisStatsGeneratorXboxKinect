<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>KINECT STATS GENERATOR FOR SPORTS VISUALISATION: KinectInterface.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>KinectInterface.cpp</h1><a href="_kinect_interface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * This file is part of the OpenKinect Project. http://www.openkinect.org</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2010 individual OpenKinect contributors. See the CONTRIB file</span>
<a name="l00005"></a>00005 <span class="comment"> * for details.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * This code is licensed to you under the terms of the Apache License, version</span>
<a name="l00008"></a>00008 <span class="comment"> * 2.0, or, at your option, the terms of the GNU General Public License,</span>
<a name="l00009"></a>00009 <span class="comment"> * version 2.0. See the APACHE20 and GPL2 files for the text of the licenses,</span>
<a name="l00010"></a>00010 <span class="comment"> * or the following URLs:</span>
<a name="l00011"></a>00011 <span class="comment"> * http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00012"></a>00012 <span class="comment"> * http://www.gnu.org/licenses/gpl-2.0.txt</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * If you redistribute this file in source form, modified or unmodified, you</span>
<a name="l00015"></a>00015 <span class="comment"> * may:</span>
<a name="l00016"></a>00016 <span class="comment"> *   1) Leave this header intact and distribute it under the same terms,</span>
<a name="l00017"></a>00017 <span class="comment"> *      accompanying it with the APACHE20 and GPL20 files, or</span>
<a name="l00018"></a>00018 <span class="comment"> *   2) Delete the Apache 2.0 clause and accompany it with the GPL2 file, or</span>
<a name="l00019"></a>00019 <span class="comment"> *   3) Delete the GPL v2 clause and accompany it with the APACHE20 file</span>
<a name="l00020"></a>00020 <span class="comment"> * In all cases you must keep the copyright notice intact and include a copy</span>
<a name="l00021"></a>00021 <span class="comment"> * of the CONTRIB file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Binary distributions must follow the binary distribution requirements of</span>
<a name="l00024"></a>00024 <span class="comment"> * either License.</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00031"></a>00031 <span class="comment"></span><span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="_kinect_interface_8h.html" title="a Qt wrapper for the OpenKinect project a lot of the code has been modified from...">KinectInterface.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00038"></a>00038 <span class="comment">//#include &lt;boost/lexical_cast.hpp&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00043"></a>00043 <a class="code" href="class_kinect_interface.html" title="this class wraps the libfreenect library as a QObject this allows us to use singals...">KinectInterface</a> *<a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">KinectInterface::s_instance</a> = 0;<span class="comment">// initialize pointer</span>
<a name="l00044"></a>00044 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00048"></a><a class="code" href="class_q_kinect_process_events.html#a98e46ec84f280b7cb2b7ea17ef3b3e69">00048</a> <span class="keywordtype">void</span> <a class="code" href="class_q_kinect_process_events.html#a98e46ec84f280b7cb2b7ea17ef3b3e69" title="the actual thread main loop, this is not callable and the QThread::start method of...">QKinectProcessEvents::run</a>()
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     <span class="comment">// loop while we are active and process the kinect event queue</span>
<a name="l00051"></a>00051     <span class="keywordflow">while</span>(<a class="code" href="class_q_kinect_process_events.html#a5ee9f2067a92c34974a9431c845e1150" title="a flag to indicate if the loop is to be active set true in the ctor">m_active</a>)
<a name="l00052"></a>00052     {
<a name="l00053"></a>00053         <span class="comment">//qDebug()&lt;&lt;&quot;process thread\n&quot;;</span>
<a name="l00054"></a>00054         <span class="keywordflow">if</span>(freenect_process_events(<a class="code" href="class_q_kinect_process_events.html#adda9321c405fd24004fd07b35838403f" title="the context of the kinect device, this must be set before the thread is run with...">m_ctx</a>) &lt; 0)
<a name="l00055"></a>00055         {
<a name="l00056"></a>00056             <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot process freenect events&quot;</span>);
<a name="l00057"></a>00057         }
<a name="l00058"></a>00058     }
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00063"></a>00063 <span class="comment"></span><span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00064"></a><a class="code" href="class_kinect_interface.html#a41d55016ae8ebd23b770d6124c5aea27">00064</a> <a class="code" href="class_kinect_interface.html#a41d55016ae8ebd23b770d6124c5aea27" title="private dtor as we are a singleton class">KinectInterface::~KinectInterface</a>()
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066         <span class="comment">// dtor is not called directly</span>
<a name="l00067"></a>00067         <span class="keywordflow">if</span> (<a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a>)
<a name="l00068"></a>00068         {
<a name="l00069"></a>00069                 <span class="keyword">delete</span> <a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a>;
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00074"></a>00074 <span class="comment"></span><span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00075"></a><a class="code" href="class_kinect_interface.html#a13c9a56bd98aaf46329914b7323944c7">00075</a> <a class="code" href="class_kinect_interface.html" title="this class wraps the libfreenect library as a QObject this allows us to use singals...">KinectInterface</a>* <a class="code" href="class_kinect_interface.html#a13c9a56bd98aaf46329914b7323944c7" title="get the instance of the KinectInterface object this will call the init method of...">KinectInterface::instance</a>()
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="comment">// this is the main singleton code first check to see if we exist</span>
<a name="l00078"></a>00078     <span class="keywordflow">if</span> (<a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a>==0 )
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080         <span class="comment">// we do so create an instance (this will validate the pointer so other</span>
<a name="l00081"></a>00081         <span class="comment">// methods called in the init function will have a valid pointer to use)</span>
<a name="l00082"></a>00082         <a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a> = <span class="keyword">new</span> <a class="code" href="class_kinect_interface.html" title="this class wraps the libfreenect library as a QObject this allows us to use singals...">KinectInterface</a>;
<a name="l00083"></a>00083         <span class="comment">// now setup the actual class (with a valid pointer)</span>
<a name="l00085"></a>00085 <span class="comment"></span>        <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a>-&gt;<a class="code" href="class_kinect_interface.html#a98b9d6c718284304d466c8115d97d0f1" title="private copy ctor as we are a singleton class">init</a>() ==  <span class="keyword">false</span>)
<a name="l00086"></a>00086         {
<a name="l00087"></a>00087             <a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a> = 0;
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089     }
<a name="l00090"></a>00090     <span class="comment">// otherwise return the existing pointer</span>
<a name="l00091"></a>00091     <span class="keywordflow">return</span> <a class="code" href="class_kinect_interface.html#a852d95b98effaf033d99ac1adb016f73" title="our instance of the Kinect device">s_instance</a>;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00096"></a><a class="code" href="class_kinect_interface.html#a4e6462987f57c1ff0e3ed4fe3f7cae10">00096</a> <a class="code" href="class_kinect_interface.html#a4e6462987f57c1ff0e3ed4fe3f7cae10" title="private ctor as we are a singleton class">KinectInterface::KinectInterface</a>() : QObject(0)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <span class="comment">// nothing to see here we just need a valid object pointer the init</span>
<a name="l00099"></a>00099     <span class="comment">// method does all the hard work</span>
<a name="l00100"></a>00100     qDebug()&lt;&lt;<span class="stringliteral">&quot;ctor called \n&quot;</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ; i &lt; 640*480 ; ++i)
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104         <a class="code" href="class_kinect_interface.html#a08a8290bb2f445728df5e5c081e114ab">m_bufferDepthinM</a>[i] = 0;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00112"></a><a class="code" href="class_kinect_interface.html#a98b9d6c718284304d466c8115d97d0f1">00112</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a98b9d6c718284304d466c8115d97d0f1" title="private copy ctor as we are a singleton class">KinectInterface::init</a>()
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="comment">// first see if we can init the kinect</span>
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (freenect_init(&amp;<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>, NULL) &lt; 0)
<a name="l00116"></a>00116     {
<a name="l00117"></a>00117         qDebug()&lt;&lt;<span class="stringliteral">&quot;freenect_init() failed\n&quot;</span>;
<a name="l00118"></a>00118         exit(EXIT_FAILURE);
<a name="l00119"></a>00119     }
<a name="l00121"></a>00121     freenect_set_log_level(<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>, FREENECT_LOG_DEBUG);
<a name="l00123"></a>00123     <span class="keywordtype">int</span> nr_devices = freenect_num_devices (<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>);
<a name="l00124"></a>00124     qDebug()&lt;&lt;<span class="stringliteral">&quot;Number of devices found: &quot;</span>&lt;&lt;nr_devices&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keywordflow">if</span>(nr_devices &lt; 1)
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128         <span class="comment">//delete s_instance;</span>
<a name="l00129"></a>00129         <span class="comment">//s_instance = 0;</span>
<a name="l00130"></a>00130         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00131"></a>00131     }
<a name="l00133"></a>00133     <a class="code" href="class_kinect_interface.html#ad6f3dd6f3dc34c44ef0056407d085408" title="user device number">m_userDeviceNumber</a> = 0;
<a name="l00134"></a>00134     <span class="comment">// grab the buffer size and store for later use</span>
<a name="l00135"></a>00135     <a class="code" href="class_kinect_interface.html#a3f5c05c31e6b0b58c54bbe9df7b31cd9" title="size of the RGB buffer for the current mode">m_resolutionRGBBytes</a>=freenect_find_video_mode(FREENECT_RESOLUTION_MEDIUM,FREENECT_VIDEO_RGB).bytes;
<a name="l00136"></a>00136     <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>=cvCreateMat(480,640,CV_8UC3);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="comment">//m_bufferVideo.resize(m_resolutionRGBBytes);</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <a class="code" href="class_kinect_interface.html#af0f9011f62e90ab66b30a30db870e46d" title="our video buffer for the current rgb video frames will be filled from the rgb callback...">m_bufferVideo</a> = cvCreateMat(480,640,CV_8UC3);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="comment">//    m_nextBuffer = cvCreateMat(480,640,CV_8UC1);</span>
<a name="l00143"></a>00143 <span class="comment">//    m_prevBuffer = cvCreateMat(480,640,CV_8UC1);</span>
<a name="l00144"></a>00144 <span class="comment">//    m_diffBuffer = cvCreateMat(480,640,CV_8UC1);</span>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <a class="code" href="class_kinect_interface.html#a36f10fca244ca8382c2d6bcee9132e7a" title="size of the depth buffer for the current mode">m_resolutionDepthBytes</a>=freenect_find_depth_mode(FREENECT_RESOLUTION_MEDIUM,FREENECT_DEPTH_11BIT).bytes;
<a name="l00147"></a>00147     <span class="comment">//m_bufferDepthRaw.resize(m_resolutionDepthBytes);</span>
<a name="l00148"></a>00148     <a class="code" href="class_kinect_interface.html#ad4bce1c22c201eeca611a43f836bedb7" title="the 16Bit raw depth values, this is good for voxel rendering of the data">m_bufferDepthRaw16</a>=cvCreateMat(480,640,CV_8UC1);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <a class="code" href="class_kinect_interface.html#af89953fcc5f04b92ba317c2f0a0f6680" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepthRaw</a>=cvCreateMat(480,640,CV_8UC1);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154    <span class="comment">// m_originalFrameDepth=NULL;</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <a class="code" href="class_kinect_interface.html#ab09abb222064475267cc397e027b47bd" title="our gamma table this is filled in the ctor and used in the depth callbacks, this...">m_gamma</a>.resize(2048);
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (freenect_open_device(<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>, &amp;<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, <a class="code" href="class_kinect_interface.html#ad6f3dd6f3dc34c44ef0056407d085408" title="user device number">m_userDeviceNumber</a>) &lt; 0)
<a name="l00163"></a>00163     {
<a name="l00164"></a>00164         qDebug()&lt;&lt;<span class="stringliteral">&quot;Could not open device\n&quot;</span>;
<a name="l00165"></a>00165         exit(EXIT_FAILURE);
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00171"></a>00171 <span class="comment">//    for (int i=0; i&lt;2048; ++i)</span>
<a name="l00172"></a>00172 <span class="comment">//    {</span>
<a name="l00173"></a>00173 <span class="comment">//        float v = i/2048.0;</span>
<a name="l00174"></a>00174 <span class="comment">//        v = std::pow(v, 3)* 6;</span>
<a name="l00175"></a>00175 <span class="comment">//        m_gamma[i] = v*6*256;</span>
<a name="l00176"></a>00176 <span class="comment">//    }</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">// from opencv imaging imformation wiki page http://openkinect.org/wiki/Imaging_Information</span>
<a name="l00180"></a>00180     <span class="keyword">const</span> <span class="keywordtype">float</span> k1 = 1.1863;
<a name="l00181"></a>00181     <span class="keyword">const</span> <span class="keywordtype">float</span> k2 = 2842.5;
<a name="l00182"></a>00182     <span class="keyword">const</span> <span class="keywordtype">float</span> k3 = 0.1236;
<a name="l00183"></a>00183     <span class="keyword">const</span> <span class="keywordtype">float</span> offset = 0.037;
<a name="l00184"></a>00184     <span class="keywordtype">float</span> depth = 0;
<a name="l00185"></a>00185     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;2048; i++)
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187         depth = k3 * tanf(i/k2 + k1) - offset;
<a name="l00188"></a>00188         <a class="code" href="class_kinect_interface.html#ab09abb222064475267cc397e027b47bd" title="our gamma table this is filled in the ctor and used in the depth callbacks, this...">m_gamma</a>[i] = depth;
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00193"></a>00193     <a class="code" href="class_kinect_interface.html#af48b4d61f146ffd61f27bf9c21f2dbd2" title="flag to indicate if there is a new rgb frame">m_newRgbFrame</a>=<span class="keyword">false</span>;
<a name="l00194"></a>00194     <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a>=<span class="keyword">false</span>;
<a name="l00195"></a>00195     <a class="code" href="class_kinect_interface.html#a1c90cd136731712742411214de8acceb" title="flag to indicate if the device is active">m_deviceActive</a>=<span class="keyword">true</span>;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <a class="code" href="class_kinect_interface.html#aedd939dc1a2a20fa61fa436c0598790d">m_threshValue</a> = 100;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="comment">// set our video formats to RGB by default</span>
<a name="l00202"></a>00202 <span class="comment"></span>    freenect_set_video_mode(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, freenect_find_video_mode(FREENECT_RESOLUTION_MEDIUM, FREENECT_VIDEO_RGB));
<a name="l00203"></a>00203     freenect_set_depth_mode(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, freenect_find_depth_mode(FREENECT_RESOLUTION_MEDIUM, FREENECT_DEPTH_11BIT));
<a name="l00204"></a>00204     <span class="comment">// deprecated</span>
<a name="l00205"></a>00205     <span class="comment">//freenect_set_video_format(m_dev, FREENECT_VIDEO_RGB);</span>
<a name="l00206"></a>00206     <span class="comment">//freenect_set_depth_format(m_dev, FREENECT_DEPTH_11BIT);</span>
<a name="l00208"></a>00208 <span class="comment"></span>    freenect_set_depth_callback(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, <a class="code" href="class_kinect_interface.html#a87b442a4f36e646fd9f0d27509030f84" title="this hooks into the feenet callback system an is the main way of getting the data...">depthCallback</a>);
<a name="l00209"></a>00209     freenect_set_video_callback(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, <a class="code" href="class_kinect_interface.html#aa08ef063072d6dd62b72507c87fa689a" title="this hooks into the feenet callback system an is the main way of getting the data...">videoCallback</a>);
<a name="l00210"></a>00210     <span class="comment">// start the video and depth sub systems</span>
<a name="l00211"></a>00211     <a class="code" href="class_kinect_interface.html#ac175937429aed66eac7a131ba540afb3" title="start the Video buffer grabbing subsystem">startVideo</a>();
<a name="l00212"></a>00212     <a class="code" href="class_kinect_interface.html#aa6b0220f7d3310199f699a11ad04e1d0" title="start the Depth buffer grabbing subsystem">startDepth</a>();
<a name="l00213"></a>00213     <span class="comment">// set the thread to be active and start</span>
<a name="l00214"></a>00214     <a class="code" href="class_kinect_interface.html#a05d888f70ececf3d5da5d0520eb2a2ef" title="pointer to our thread process used to process the events">m_process</a> = <span class="keyword">new</span> <a class="code" href="class_q_kinect_process_events.html" title="this is the process event thread class it needs to be a class so we can use the Qt...">QKinectProcessEvents</a>(<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>);
<a name="l00215"></a>00215     <a class="code" href="class_kinect_interface.html#a05d888f70ececf3d5da5d0520eb2a2ef" title="pointer to our thread process used to process the events">m_process</a>-&gt;<a class="code" href="class_q_kinect_process_events.html#a492cc55fcd53ffc1d4d2e4822c9234dc" title="sets the thread active this will loop the run thread with a while(m_active) setting...">setActive</a>();
<a name="l00216"></a>00216     <a class="code" href="class_kinect_interface.html#a05d888f70ececf3d5da5d0520eb2a2ef" title="pointer to our thread process used to process the events">m_process</a>-&gt;start();
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <a class="code" href="class_kinect_interface.html#a003069902ab58ac52a8246eb9cb45b86">m_depthLower</a> = 0.02;
<a name="l00219"></a>00219     <a class="code" href="class_kinect_interface.html#a521eefa3b5b51e2724edaf0df52bb5b4">m_depthHigher</a> = 1.02; <span class="comment">// has to be just above the table (in meteres)</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="comment">//m_selectedBoxCoords = NULL;</span>
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a> = cv::Rect(0,0,0,0);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <a class="code" href="class_kinect_interface.html#a5ace07ec14c58fddf7dbd806cecfdd1e">m_toggleTracking</a> = <span class="keyword">false</span>;
<a name="l00226"></a>00226     <a class="code" href="class_kinect_interface.html#aa2f9c4cb2e1d63b8f5d2b7967e774d51">m_setBounds</a> = <span class="keyword">false</span>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00232"></a><a class="code" href="class_kinect_interface.html#ade531f82baadaeefe01f9c3e37340930">00232</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#ade531f82baadaeefe01f9c3e37340930" title="method to shutdown our device and close">KinectInterface::shutDownKinect</a>()
<a name="l00233"></a>00233 {
<a name="l00235"></a>00235     <a class="code" href="class_kinect_interface.html#a05d888f70ececf3d5da5d0520eb2a2ef" title="pointer to our thread process used to process the events">m_process</a>-&gt;<a class="code" href="class_q_kinect_process_events.html#a0b5a492232dcce352a77a183dab34cb4" title="sets the thread active must call QThread::start again to make this work if the thread...">setInActive</a>();
<a name="l00237"></a>00237     freenect_stop_depth(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>);
<a name="l00238"></a>00238     freenect_stop_video(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>);
<a name="l00239"></a>00239     <span class="comment">// close down our devices</span>
<a name="l00240"></a>00240     freenect_close_device(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>);
<a name="l00241"></a>00241     freenect_shutdown(<a class="code" href="class_kinect_interface.html#aaa1711822e094f956c2e54ef2230a52a" title="the contex for the device">m_ctx</a>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00245"></a><a class="code" href="class_kinect_interface.html#add145b8666b0b72861cc06df0bb47dbb">00245</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#add145b8666b0b72861cc06df0bb47dbb" title="slot to turn off the led">KinectInterface::setLedOff</a>()
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_OFF);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00250"></a><a class="code" href="class_kinect_interface.html#a3e91820cd20f31e943e38af945de689e">00250</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a3e91820cd20f31e943e38af945de689e" title="slot to enable the red LED">KinectInterface::setRedLed</a>()
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_RED);
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00255"></a><a class="code" href="class_kinect_interface.html#ac30fbf5db6434a4afa79e435b812d212">00255</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#ac30fbf5db6434a4afa79e435b812d212" title="slot to enable the green LED">KinectInterface::setGreenLed</a>()
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_GREEN);
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00260"></a><a class="code" href="class_kinect_interface.html#a177a59f3e4f860db0f2286f57884b7a3">00260</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a177a59f3e4f860db0f2286f57884b7a3" title="slot to enable the yellow LED">KinectInterface::setYellowLed</a>()
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_YELLOW);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00265"></a><a class="code" href="class_kinect_interface.html#aedd6b9e8d3a5a508cc5021edfc608357">00265</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#aedd6b9e8d3a5a508cc5021edfc608357" title="slot to flash the red led">KinectInterface::setRedLedFlash</a>()
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_BLINK_RED_YELLOW);
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00270"></a><a class="code" href="class_kinect_interface.html#a524a26cdd4464ba8846e207d6552f977">00270</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a524a26cdd4464ba8846e207d6552f977" title="slot to flash the green led">KinectInterface::setGreenLedFlash</a>()
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272  freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_BLINK_GREEN);
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00275"></a><a class="code" href="class_kinect_interface.html#ab920f30201f47f3fb99fdbcbd1d81217">00275</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#ab920f30201f47f3fb99fdbcbd1d81217" title="slot to flash the yellow led">KinectInterface::setYellowLedFlash</a>()
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     freenect_set_led(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,LED_BLINK_RED_YELLOW);
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00280"></a><a class="code" href="class_kinect_interface.html#a7120a337446097931e964ed47a4421ce">00280</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a7120a337446097931e964ed47a4421ce" title="slot to set the video mode">KinectInterface::setVideoMode</a>(
<a name="l00281"></a>00281                                                      <span class="keywordtype">int</span> _mode
<a name="l00282"></a>00282                                                     )
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     freenect_video_format vm=FREENECT_VIDEO_RGB;
<a name="l00285"></a>00285     <span class="keywordflow">switch</span>(_mode)
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         <span class="keywordflow">case</span> 0 : { vm=FREENECT_VIDEO_RGB; <span class="keywordflow">break</span>;}
<a name="l00288"></a>00288         <span class="keywordflow">case</span> 1 : { vm=FREENECT_VIDEO_YUV_RGB; <span class="keywordflow">break</span>;}
<a name="l00289"></a>00289         <span class="keywordflow">case</span> 2 : { vm=FREENECT_VIDEO_IR_8BIT; <span class="keywordflow">break</span>;}
<a name="l00290"></a>00290         <span class="comment">/*</span>
<a name="l00292"></a>00292 <span class="comment">        case 1 : { vm=FREENECT_VIDEO_BAYER; break;}</span>
<a name="l00293"></a>00293 <span class="comment">        case 2 : { vm=FREENECT_VIDEO_IR_8BIT; break;}</span>
<a name="l00294"></a>00294 <span class="comment">        case 3 : { vm=FREENECT_VIDEO_IR_10BIT; break;}</span>
<a name="l00295"></a>00295 <span class="comment">        case 4 : { vm=FREENECT_VIDEO_IR_10BIT_PACKED; break;}</span>
<a name="l00296"></a>00296 <span class="comment">        case 5 : { vm=FREENECT_VIDEO_YUV_RGB; break;}</span>
<a name="l00297"></a>00297 <span class="comment">        case 6 : { vm=FREENECT_VIDEO_YUV_RAW; break;}</span>
<a name="l00298"></a>00298 <span class="comment">        */</span>
<a name="l00299"></a>00299         <span class="keywordflow">default</span> : qDebug()&lt;&lt;<span class="stringliteral">&quot;index out of bounds for video mode\n&quot;</span>;
<a name="l00300"></a>00300                             vm=FREENECT_VIDEO_RGB;
<a name="l00301"></a>00301         <span class="keywordflow">break</span>;
<a name="l00302"></a>00302     }
<a name="l00304"></a>00304     freenect_stop_video(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>);
<a name="l00305"></a>00305     freenect_set_video_mode(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>, freenect_find_video_mode(FREENECT_RESOLUTION_MEDIUM, FREENECT_VIDEO_RGB));
<a name="l00306"></a>00306     <span class="comment">//deprecated</span>
<a name="l00307"></a>00307 <span class="comment">//  freenect_set_video_format(m_dev, vm);</span>
<a name="l00308"></a>00308     freenect_start_video(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>);
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00311"></a><a class="code" href="class_kinect_interface.html#ae65ee9362b2ed21763de02df1e073770">00311</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#ae65ee9362b2ed21763de02df1e073770" title="reset the tilt angle">KinectInterface::resetAngle</a>()
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313     freenect_set_tilt_degs(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,0);
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00317"></a><a class="code" href="class_kinect_interface.html#a8bcb263a8baccc017e37764bcbb43c53">00317</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a8bcb263a8baccc017e37764bcbb43c53" title="slot to change the angle of the Kinect">KinectInterface::setAngle</a>(
<a name="l00318"></a>00318                                              <span class="keywordtype">double</span> _angle
<a name="l00319"></a>00319                                             )
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="comment">// constrain the angle from -30 - +30</span>
<a name="l00322"></a>00322     <span class="keywordflow">if</span>(_angle &gt; 30)
<a name="l00323"></a>00323     {
<a name="l00324"></a>00324         _angle = 30;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(_angle &lt;-30)
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328         _angle=-30;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     freenect_set_tilt_degs(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>,_angle);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00335"></a><a class="code" href="class_kinect_interface.html#a812d3a247e41f00345c3e48a73abe048">00335</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a812d3a247e41f00345c3e48a73abe048" title="get the RGB buffer">KinectInterface::getRGB</a>(cv::Mat &amp;o_buffer)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <span class="comment">//static int _frameCount = 1;</span>
<a name="l00341"></a>00341 <span class="comment"></span>    QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00342"></a>00342     <span class="comment">// do we have a new frame?</span>
<a name="l00343"></a>00343     <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#af48b4d61f146ffd61f27bf9c21f2dbd2" title="flag to indicate if there is a new rgb frame">m_newRgbFrame</a>)
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="comment">//cv::GaussianBlur(m_bufferVideo,m_bufferVideo,cv::Size(3,3),0.3);</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="comment">//        cv::cvtColor( m_bufferVideo, m_bufferVideoGray, CV_BGR2GRAY );</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">//        // if so swap out and fill</span>
<a name="l00352"></a>00352 <span class="comment">//        if(_frameCount == 1)</span>
<a name="l00353"></a>00353 <span class="comment">//        {</span>
<a name="l00354"></a>00354 <span class="comment">//            m_bufferVideoGray.copyTo(m_prevBuffer);</span>
<a name="l00355"></a>00355 <span class="comment">//            //m_bufferVideo.copyTo(m_newBuffer);</span>
<a name="l00356"></a>00356 <span class="comment">//        }</span>
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">//        m_bufferVideoGray.copyTo(m_nextBuffer);</span>
<a name="l00359"></a>00359 <span class="comment">//        cv::absdiff(m_nextBuffer,m_prevBuffer,m_diffBuffer); // has gpu variant</span>
<a name="l00360"></a>00360 <span class="comment">//        //m_diffBuffer.copyTo(m_nextBuffer - m_prevBuffer); // use cv function</span>
<a name="l00361"></a>00361 <span class="comment">//        m_nextBuffer.copyTo(m_prevBuffer);</span>
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="comment">//        m_diffBuffer.copyTo(o_buffer);</span>
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="comment">//        _frameCount++;</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         <a class="code" href="class_kinect_interface.html#af0f9011f62e90ab66b30a30db870e46d" title="our video buffer for the current rgb video frames will be filled from the rgb callback...">m_bufferVideo</a>.copyTo(o_buffer);
<a name="l00368"></a>00368         <a class="code" href="class_kinect_interface.html#af48b4d61f146ffd61f27bf9c21f2dbd2" title="flag to indicate if there is a new rgb frame">m_newRgbFrame</a> = <span class="keyword">false</span>;
<a name="l00369"></a>00369         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371     <span class="keywordflow">else</span>
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00379"></a><a class="code" href="class_kinect_interface.html#a6196d7609dd3de67aaeda6777ce57d23">00379</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a6196d7609dd3de67aaeda6777ce57d23" title="getDepth buffer and convert it to an RGB colour representation this code is based...">KinectInterface::getDepth</a>(
<a name="l00380"></a>00380                                                 cv::Mat &amp;o_buffer
<a name="l00381"></a>00381                                             )
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383     <span class="comment">// this fills the depth buffer, first lock our mutex</span>
<a name="l00384"></a>00384     QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00385"></a>00385     <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a>)
<a name="l00386"></a>00386     {
<a name="l00387"></a>00387         <span class="comment">// swap data</span>
<a name="l00388"></a>00388         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.copyTo(o_buffer);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a> = <span class="keyword">false</span>;
<a name="l00391"></a>00391         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     <span class="keywordflow">else</span>
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00399"></a><a class="code" href="class_kinect_interface.html#a24f97f36a57a0f01481a85a57d16ea72">00399</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a24f97f36a57a0f01481a85a57d16ea72" title="getDepth buffer as the raw 16 Bit values this is useful for generating point cloud...">KinectInterface::getDepth16Bit</a>(
<a name="l00400"></a>00400                                                          cv::Mat &amp;o_buffer
<a name="l00401"></a>00401                                                      )
<a name="l00402"></a>00402 {
<a name="l00404"></a>00404     QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00405"></a>00405     <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a>)
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407         <span class="comment">// fill our buffer if avaliable</span>
<a name="l00408"></a>00408         <a class="code" href="class_kinect_interface.html#ad4bce1c22c201eeca611a43f836bedb7" title="the 16Bit raw depth values, this is good for voxel rendering of the data">m_bufferDepthRaw16</a>.copyTo(o_buffer);
<a name="l00409"></a>00409         <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a> = <span class="keyword">false</span>;
<a name="l00410"></a>00410         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412     <span class="keywordflow">else</span>
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00420"></a><a class="code" href="class_kinect_interface.html#a156e7bc1a98606de05c47e13567d71bc">00420</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a156e7bc1a98606de05c47e13567d71bc">KinectInterface::getDepthSliced</a>(
<a name="l00421"></a>00421                                                          cv::Mat &amp;o_buffer
<a name="l00422"></a>00422                                                      )
<a name="l00423"></a>00423 {
<a name="l00425"></a>00425     QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00426"></a>00426     <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a>)
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428         <span class="comment">// fill our buffer if avaliable</span>
<a name="l00429"></a>00429         <a class="code" href="class_kinect_interface.html#af89953fcc5f04b92ba317c2f0a0f6680" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepthRaw</a>.copyTo(o_buffer);
<a name="l00430"></a>00430         <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a> = <span class="keyword">false</span>;
<a name="l00431"></a>00431         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">else</span>
<a name="l00434"></a>00434     {
<a name="l00435"></a>00435         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00440"></a><a class="code" href="class_kinect_interface.html#af6c36c376554c5debbbcdf4f8384e32e">00440</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#af6c36c376554c5debbbcdf4f8384e32e" title="getDepth buffer as the raw values converted to uint8_t not sure if this will be much...">KinectInterface::getDepthRaw</a>(cv::Mat &amp;o_buffer, <span class="keywordtype">float</span> *o_depthinmBuffer)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00445"></a>00445     <span class="keywordflow">if</span>(<a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a>)
<a name="l00446"></a>00446     {
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         <a class="code" href="class_kinect_interface.html#af89953fcc5f04b92ba317c2f0a0f6680" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepthRaw</a>.copyTo(o_buffer);
<a name="l00449"></a>00449         <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ; i &lt; 640*480 ; ++i)
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451             o_depthinmBuffer[i] = <a class="code" href="class_kinect_interface.html#a08a8290bb2f445728df5e5c081e114ab">m_bufferDepthinM</a>[i];
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453         <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a> = <span class="keyword">false</span>;
<a name="l00454"></a>00454         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456     <span class="keywordflow">else</span>
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00462"></a><a class="code" href="class_kinect_interface.html#a94998433b4c199f8fc167f7d5abd0262">00462</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a94998433b4c199f8fc167f7d5abd0262" title="method to grab the depth passed to the depthCallback function as we are hooking into...">KinectInterface::grabDepth</a>(
<a name="l00463"></a>00463                                                 <span class="keywordtype">void</span> *_depth,
<a name="l00464"></a>00464                                                 uint32_t _timestamp
<a name="l00465"></a>00465                                              )
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467 <span class="comment">// this method fills all the different depth buffers at once</span>
<a name="l00468"></a>00468 <span class="comment">// modifed from the sample code glview and cppview.cpp</span>
<a name="l00470"></a>00470 <span class="comment"></span>QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00471"></a>00471 <span class="comment">// cast the void pointer to the unint16_t the data is actually in</span>
<a name="l00472"></a>00472 uint16_t* depth = <span class="keyword">static_cast&lt;</span>uint16_t*<span class="keyword">&gt;</span>(_depth);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">// now loop and fill data buffers</span>
<a name="l00477"></a>00477 <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ; i &lt; 640*480 ; ++i)
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479     <span class="comment">// first our two raw buffers the first will lose precision and may well</span>
<a name="l00480"></a>00480     <span class="comment">// be removed in the next iterations</span>
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">// now get the index into the gamma table</span>
<a name="l00483"></a>00483     <span class="keywordtype">float</span> pval = <a class="code" href="class_kinect_interface.html#ab09abb222064475267cc397e027b47bd" title="our gamma table this is filled in the ctor and used in the depth callbacks, this...">m_gamma</a>[depth[i]]; <span class="comment">// my notes: so pval is in metres now..using cam caliberation values, we have converted depth values to metres</span>
<a name="l00484"></a>00484                                     <span class="comment">// using open kinect forum formulae this (i,j,z) value can be transformed to (x,y,z)</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="comment">//m_bufferDepthinM.data[i] = m_gamma[depth[i]];</span>
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="comment">//m_originalFrameDepth1[_frameCountGrab] = m_gamma[depth[i]];</span>
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="comment">//std::cout&lt;&lt;&quot;pval is&quot;&lt;&lt;pval&lt;&lt;&quot;\n&quot;;</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">// a bounded volume as explained in rally keeper project to detect contours</span>
<a name="l00498"></a>00498     <span class="keywordflow">if</span> (pval &gt;= <a class="code" href="class_kinect_interface.html#a003069902ab58ac52a8246eb9cb45b86">m_depthLower</a> &amp;&amp; pval &lt;= <a class="code" href="class_kinect_interface.html#a521eefa3b5b51e2724edaf0df52bb5b4">m_depthHigher</a>)
<a name="l00499"></a>00499     {
<a name="l00500"></a>00500         <a class="code" href="class_kinect_interface.html#af89953fcc5f04b92ba317c2f0a0f6680" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepthRaw</a>.data[i]=255;
<a name="l00501"></a>00501         <a class="code" href="class_kinect_interface.html#ad4bce1c22c201eeca611a43f836bedb7" title="the 16Bit raw depth values, this is good for voxel rendering of the data">m_bufferDepthRaw16</a>.data[i]=255;
<a name="l00502"></a>00502         <a class="code" href="class_kinect_interface.html#a08a8290bb2f445728df5e5c081e114ab">m_bufferDepthinM</a>[i] = depth[i];
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504     <span class="keywordflow">else</span>
<a name="l00505"></a>00505     {
<a name="l00506"></a>00506         <a class="code" href="class_kinect_interface.html#af89953fcc5f04b92ba317c2f0a0f6680" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepthRaw</a>.data[i]=0;
<a name="l00507"></a>00507         <a class="code" href="class_kinect_interface.html#ad4bce1c22c201eeca611a43f836bedb7" title="the 16Bit raw depth values, this is good for voxel rendering of the data">m_bufferDepthRaw16</a>.data[i]=0;
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (pval &lt;= 0.9)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+0] = 255;
<a name="l00512"></a>00512         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+1] = 0;
<a name="l00513"></a>00513         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+2] = 0;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pval &gt; 0.9 &amp;&amp; pval &lt;= 2)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+0] = 0;
<a name="l00519"></a>00519         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+1] = 255;
<a name="l00520"></a>00520         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+2] = 0;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pval &gt; 2)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+0] = 0;
<a name="l00526"></a>00526         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+1] = 0;
<a name="l00527"></a>00527         <a class="code" href="class_kinect_interface.html#ae31e98852051b1b7fcd47d38173141e2" title="our depth buffer for the current depth frames will be filled from the depth callback...">m_bufferDepth</a>.data[3*i+2] = 255;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 <span class="comment">// flag we have a new frame</span>
<a name="l00532"></a>00532 <a class="code" href="class_kinect_interface.html#ae328c2cb818245881e2e98456872759c" title="flag to indicate if there is a new depth frame">m_newDepthFrame</a> = <span class="keyword">true</span>;
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00535"></a><a class="code" href="class_kinect_interface.html#a350fab4e013ae9ebba93951e0c0ae097">00535</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a350fab4e013ae9ebba93951e0c0ae097" title="method to grab the Video passed to the depthCallback function as we are hooking into...">KinectInterface::grabVideo</a>(
<a name="l00536"></a>00536                                                 <span class="keywordtype">void</span> *_video,
<a name="l00537"></a>00537                                                 uint32_t _timestamp
<a name="l00538"></a>00538                                              )
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     <span class="comment">// lock our mutex and copy the data from the video buffer</span>
<a name="l00541"></a>00541     QMutexLocker locker( &amp;<a class="code" href="class_kinect_interface.html#a02e2504b52eb0e0f94d0a89a884107a9" title="our mutex used for the threaded processes, for ease we use a QMutexLocker to automagically...">m_mutex</a> );
<a name="l00542"></a>00542     uint8_t* rgb = <span class="keyword">static_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(_video);
<a name="l00543"></a>00543     <span class="comment">//std::copy(rgb, rgb+m_resolutionRGBBytes, m_bufferVideo.begin());</span>
<a name="l00544"></a>00544     memcpy(  <a class="code" href="class_kinect_interface.html#af0f9011f62e90ab66b30a30db870e46d" title="our video buffer for the current rgb video frames will be filled from the rgb callback...">m_bufferVideo</a>.data , rgb, <a class="code" href="class_kinect_interface.html#a3f5c05c31e6b0b58c54bbe9df7b31cd9" title="size of the RGB buffer for the current mode">m_resolutionRGBBytes</a>);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <a class="code" href="class_kinect_interface.html#af48b4d61f146ffd61f27bf9c21f2dbd2" title="flag to indicate if there is a new rgb frame">m_newRgbFrame</a> = <span class="keyword">true</span>;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00550"></a><a class="code" href="class_kinect_interface.html#ac175937429aed66eac7a131ba540afb3">00550</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#ac175937429aed66eac7a131ba540afb3" title="start the Video buffer grabbing subsystem">KinectInterface::startVideo</a>()
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552     <span class="keywordflow">if</span>(freenect_start_video(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>) &lt; 0)
<a name="l00553"></a>00553     {
<a name="l00554"></a>00554         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot start RGB callback&quot;</span>);
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00558"></a><a class="code" href="class_kinect_interface.html#a0e2c57289a79b81b85d9e5b58e661e1e">00558</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a0e2c57289a79b81b85d9e5b58e661e1e" title="stop the Depth buffer grabbing subsystem">KinectInterface::stopVideo</a>()
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     <span class="keywordflow">if</span>(freenect_stop_video(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>) &lt; 0)
<a name="l00561"></a>00561     {
<a name="l00562"></a>00562         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot stop RGB callback&quot;</span>);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00566"></a><a class="code" href="class_kinect_interface.html#aa6b0220f7d3310199f699a11ad04e1d0">00566</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#aa6b0220f7d3310199f699a11ad04e1d0" title="start the Depth buffer grabbing subsystem">KinectInterface::startDepth</a>()
<a name="l00567"></a>00567 {
<a name="l00568"></a>00568     <span class="keywordflow">if</span>(freenect_start_depth(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>) &lt; 0)
<a name="l00569"></a>00569     {
<a name="l00570"></a>00570         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot start depth callback&quot;</span>);
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00575"></a><a class="code" href="class_kinect_interface.html#a7b73cfc2d221fdfda087fe6ca5c8cd39">00575</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a7b73cfc2d221fdfda087fe6ca5c8cd39" title="stop the Depth buffer grabbing subsystem">KinectInterface::stopDepth</a>()
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <span class="keywordflow">if</span>(freenect_stop_depth(<a class="code" href="class_kinect_interface.html#a96a7824501cb30683fcff98f33916036" title="our device pointer">m_dev</a>) &lt; 0)
<a name="l00578"></a>00578     {
<a name="l00579"></a>00579         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot stop depth callback&quot;</span>);
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00584"></a><a class="code" href="class_kinect_interface.html#a9aa2f0af1e2ffdc0f41fd495fc0d4aef">00584</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a9aa2f0af1e2ffdc0f41fd495fc0d4aef" title="convenience method to toggle the video mode with a bool to indicate mode, useful...">KinectInterface::toggleVideoState</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586     <span class="keywordflow">if</span>(_mode ==<span class="keyword">true</span>)
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588         <a class="code" href="class_kinect_interface.html#ac175937429aed66eac7a131ba540afb3" title="start the Video buffer grabbing subsystem">startVideo</a>();
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     <span class="keywordflow">else</span>
<a name="l00591"></a>00591     {
<a name="l00592"></a>00592         <a class="code" href="class_kinect_interface.html#a0e2c57289a79b81b85d9e5b58e661e1e" title="stop the Depth buffer grabbing subsystem">stopVideo</a>();
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00596"></a><a class="code" href="class_kinect_interface.html#aa5ba053afb2c9fcf781e485b825f3d81">00596</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#aa5ba053afb2c9fcf781e485b825f3d81" title="convenience method to toggle the depth mode with a bool to indicate mode, useful...">KinectInterface::toggleDepthState</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598     <span class="keywordflow">if</span>(_mode == <span class="keyword">true</span>)
<a name="l00599"></a>00599     {
<a name="l00600"></a>00600         <a class="code" href="class_kinect_interface.html#aa6b0220f7d3310199f699a11ad04e1d0" title="start the Depth buffer grabbing subsystem">startDepth</a>();
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <span class="keywordflow">else</span>
<a name="l00603"></a>00603     {
<a name="l00604"></a>00604         <a class="code" href="class_kinect_interface.html#a7b73cfc2d221fdfda087fe6ca5c8cd39" title="stop the Depth buffer grabbing subsystem">stopDepth</a>();
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a><a class="code" href="class_kinect_interface.html#a2b6acade3bd4b639b7d32e14d7ea4a62">00608</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a2b6acade3bd4b639b7d32e14d7ea4a62">KinectInterface::setThreshold</a>(<span class="keywordtype">int</span> _value)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610     <a class="code" href="class_kinect_interface.html#aedd939dc1a2a20fa61fa436c0598790d">m_threshValue</a> = _value;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="class_kinect_interface.html#ac331af40aa770490f9bc7ae05a5fc588">00613</a> <span class="keywordtype">int</span> <a class="code" href="class_kinect_interface.html#ac331af40aa770490f9bc7ae05a5fc588">KinectInterface::getThreshold</a>()
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    <span class="keywordflow">return</span> <a class="code" href="class_kinect_interface.html#aedd939dc1a2a20fa61fa436c0598790d">m_threshValue</a>;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="class_kinect_interface.html#a1fe5982072f3293b1c0cf74dc0328afc">00619</a> <span class="keywordtype">float</span> <a class="code" href="class_kinect_interface.html#a1fe5982072f3293b1c0cf74dc0328afc">KinectInterface::getZValue</a>(<span class="keywordtype">int</span> _depthIndex,<span class="keywordtype">int</span> _frameIndex)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <span class="comment">//QMutexLocker locker( &amp;m_mutex );</span>
<a name="l00622"></a>00622     <span class="comment">//return m_originalFrameDepth[_frameIndex].data[_depthIndex];</span>
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a><a class="code" href="class_kinect_interface.html#a4e219776c4e21cee93dd67f5d821ad5d">00626</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a4e219776c4e21cee93dd67f5d821ad5d">KinectInterface::setDepthVolumeLower</a>(<span class="keywordtype">double</span> _inputLowerDepth)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628     <a class="code" href="class_kinect_interface.html#a003069902ab58ac52a8246eb9cb45b86">m_depthLower</a> = _inputLowerDepth;
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="class_kinect_interface.html#a84dc4e7c21807ad63bbab4148ccfe0fc">00631</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a84dc4e7c21807ad63bbab4148ccfe0fc">KinectInterface::setDepthVolumeHigher</a>(<span class="keywordtype">double</span> _inputHigherDepth)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633     <a class="code" href="class_kinect_interface.html#a521eefa3b5b51e2724edaf0df52bb5b4">m_depthHigher</a> = _inputHigherDepth;
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a><a class="code" href="class_kinect_interface.html#a35118714e940ee81a1d13d825552bc1a">00636</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a35118714e940ee81a1d13d825552bc1a">KinectInterface::setBoxObject</a>(<span class="keywordtype">int</span> _topX, <span class="keywordtype">int</span> _topY, <span class="keywordtype">int</span> _width, <span class="keywordtype">int</span> _height)
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638     <a class="code" href="class_kinect_interface.html#aa2f9c4cb2e1d63b8f5d2b7967e774d51">m_setBounds</a> = <span class="keyword">true</span>;
<a name="l00639"></a>00639     <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a>.x = _topX;
<a name="l00640"></a>00640     <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a>.y = _topY;
<a name="l00641"></a>00641     <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a>.width = _width;
<a name="l00642"></a>00642     <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a>.height = _height;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 
<a name="l00646"></a><a class="code" href="class_kinect_interface.html#ab9fbbdcce13483657ef3ade7722eaba3">00646</a> cv::Rect&amp; <a class="code" href="class_kinect_interface.html#ab9fbbdcce13483657ef3ade7722eaba3">KinectInterface::getBoxObject</a>()
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648     <span class="keywordflow">return</span> <a class="code" href="class_kinect_interface.html#a29e0604131a3c9c2552b9bc4488caec4">m_selectedBoxCoords</a>;
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a><a class="code" href="class_kinect_interface.html#a49f91219e04f60c9b75f9d7b8a68360e">00651</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#a49f91219e04f60c9b75f9d7b8a68360e">KinectInterface::toggleTracking</a>()
<a name="l00652"></a>00652 {
<a name="l00653"></a>00653     <a class="code" href="class_kinect_interface.html#a5ace07ec14c58fddf7dbd806cecfdd1e">m_toggleTracking</a> = !(<a class="code" href="class_kinect_interface.html#a5ace07ec14c58fddf7dbd806cecfdd1e">m_toggleTracking</a>);
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="class_kinect_interface.html#a69b1c94d734bfe5a28491d2fb6f70534">00656</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a69b1c94d734bfe5a28491d2fb6f70534">KinectInterface::getTrackingFlag</a>()
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658     <span class="keywordflow">return</span> <a class="code" href="class_kinect_interface.html#a5ace07ec14c58fddf7dbd806cecfdd1e">m_toggleTracking</a>;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="class_kinect_interface.html#a5ca72711b816896860035b9bfe5f51c2">00661</a> <span class="keywordtype">bool</span> <a class="code" href="class_kinect_interface.html#a5ca72711b816896860035b9bfe5f51c2">KinectInterface::getBounds</a>()
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663     <span class="keywordflow">return</span> <a class="code" href="class_kinect_interface.html#aa2f9c4cb2e1d63b8f5d2b7967e774d51">m_setBounds</a>;
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="class_kinect_interface.html#aab50a8cdc60ad80f8ecbd28b1f6af42b">00666</a> <span class="keywordtype">void</span> <a class="code" href="class_kinect_interface.html#aab50a8cdc60ad80f8ecbd28b1f6af42b">KinectInterface::setBoundsDefined</a>(<span class="keywordtype">bool</span> _isBoundsDefined)
<a name="l00667"></a>00667 {
<a name="l00668"></a>00668     <a class="code" href="class_kinect_interface.html#aa2f9c4cb2e1d63b8f5d2b7967e774d51">m_setBounds</a> = _isBoundsDefined;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 16 Aug 2013 for KINECT STATS GENERATOR FOR SPORTS VISUALISATION by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
