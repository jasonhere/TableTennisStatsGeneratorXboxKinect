<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>KINECT STATS GENERATOR FOR SPORTS VISUALISATION: BallTrackingUtility.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>BallTrackingUtility.cpp</h1><a href="_ball_tracking_utility_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="_ball_tracking_utility_8h.html" title="ball track utility">BallTrackingUtility.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="_ball_points_processing_8h.html" title="ball track utility">BallPointsProcessing.h</a>&quot;</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;libfreenect.hpp&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;libfreenect_sync.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;<a class="code" href="_mutex_8h.html">Mutex.h</a>&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;<a class="code" href="_kinect_interface_8h.html" title="a Qt wrapper for the OpenKinect project a lot of the code has been modified from...">KinectInterface.h</a>&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;ngl/NGLInit.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;ngl/ShaderLib.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;QTimer&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;QObject&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keywordtype">void</span> <a class="code" href="_ball_tracking_utility_8cpp.html#a22db37ec3597b0a303153c25efa8f0f2">thresh_callback</a>(<span class="keywordtype">int</span>, <span class="keywordtype">void</span>* );
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="_ball_tracking_utility_8cpp.html#a6f6e7dc10d561eca717e7b6f6770b304">00017</a> <span class="keywordtype">bool</span> <a class="code" href="_ball_tracking_utility_8cpp.html#a6f6e7dc10d561eca717e7b6f6770b304">compareXX</a>(cv::Point2f i, cv::Point2f j){ <span class="keywordflow">return</span> (i.x &lt; j.x);}
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="_ball_tracking_utility_8cpp.html#a40c82257e7743151785798f521216193">00019</a> <span class="keywordtype">bool</span> <a class="code" href="_ball_tracking_utility_8cpp.html#a40c82257e7743151785798f521216193">compareXXHermite</a>(cv::Point3f i, cv::Point3f j){ <span class="keywordflow">return</span> (i.x &lt; j.x);}
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="_ball_tracking_utility_8cpp.html#a5c4d882245d9cc55a9abe9bad09e2e20">00021</a> <span class="keywordtype">bool</span> <a class="code" href="_ball_tracking_utility_8cpp.html#a5c4d882245d9cc55a9abe9bad09e2e20">compareXX3D</a>(cv::Point3f i, cv::Point3f j){ <span class="keywordflow">return</span> (i.x &lt; j.x);}
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="class_ball_tracking_utility.html#a9631350a01d9eb0b2e2385acedb7936c">00024</a> <a class="code" href="class_ball_tracking_utility.html#a9631350a01d9eb0b2e2385acedb7936c" title="Constructor for RGBboundsVisualization.">BallTrackingUtility::BallTrackingUtility</a>()
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00030"></a><a class="code" href="class_ball_tracking_utility.html#a617412a5cfcf75bfa4a64768ccbfb8ee">00030</a> <a class="code" href="class_ball_tracking_utility.html#a9631350a01d9eb0b2e2385acedb7936c" title="Constructor for RGBboundsVisualization.">BallTrackingUtility::BallTrackingUtility</a>(<a class="code" href="class_ball_points_processing.html" title="processes the entire track data">BallPointsProcessing</a> *_inputBallProcessingUtility):m_ballPointProcessing(_inputBallProcessingUtility)
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033 
<a name="l00034"></a>00034   <a class="code" href="class_ball_tracking_utility.html#ac254bd37851a4b0a4ec08d04f2602065">m_rgb</a> = cvCreateMat(480,640,CV_8UC3);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   <a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a> = cvCreateMat(480,640,CV_8UC1);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <a class="code" href="class_ball_tracking_utility.html#a244cf2d970c0aa33d137ac2f3ff1bcaf">m_nextBuffer</a> = cvCreateMat(480,640,CV_8UC1);
<a name="l00039"></a>00039   <a class="code" href="class_ball_tracking_utility.html#a56b9750495fcc9113fadac90133cdd37">m_prevBuffer</a> = cvCreateMat(480,640,CV_8UC1);
<a name="l00040"></a>00040   <a class="code" href="class_ball_tracking_utility.html#a4f168409ede33e11b820aa92dd327af0">m_diffBuffer</a> = cvCreateMat(480,640,CV_8UC1);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   <a class="code" href="class_ball_tracking_utility.html#a756d69c22e183c1e280d49a6d0d58d12">m_bufferDepthRaw</a>=cvCreateMat(480,640,CV_8UC1);
<a name="l00043"></a>00043   <a class="code" href="class_ball_tracking_utility.html#a5b8df4677a463c73d2e060d9b4b9a08a">m_bufferDepthRaw1</a>=cvCreateMat(480,640,CV_8UC1);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   <a class="code" href="class_ball_tracking_utility.html#aa085251141cc2ba88f8d1dddf761c994">m_binaryLowerThresh</a> = 100.0;
<a name="l00046"></a>00046   <a class="code" href="class_ball_tracking_utility.html#a3d0956651cff3f02e2e3950bb388b070">m_binaryMaxVal</a> = 255.0;
<a name="l00047"></a>00047   <a class="code" href="class_ball_tracking_utility.html#a6cb20d610444a7b6b03c82c540ce466e">m_cannyLowerThresh</a> = 100.0;
<a name="l00048"></a>00048   <a class="code" href="class_ball_tracking_utility.html#a5ad991a7201e1e40485472ed1a84eaa5">m_cannyHigherThresh</a> = 300.0;
<a name="l00049"></a>00049   <a class="code" href="class_ball_tracking_utility.html#a8a392da18b750dd7c4abb4784805d3cd">m_contourAreaThresh</a> = 120.0;
<a name="l00050"></a>00050   <a class="code" href="class_ball_tracking_utility.html#a85dc05098c8e7f32118acc78bf14ba0d">m_diffAreaThresh</a> = 30.0;
<a name="l00051"></a>00051   <a class="code" href="class_ball_tracking_utility.html#a761be0c718feda2661316296421ca1be">m_ellipsesize</a> = 2;
<a name="l00052"></a>00052   <a class="code" href="class_ball_tracking_utility.html#ac7b78eb8702e2d12c6e81931127a654c">m_blurSize</a> = 5;
<a name="l00053"></a>00053   <a class="code" href="class_ball_tracking_utility.html#a0c3be699677a8d5904570a0493494c6c">m_noOfTimesToDialate</a> = 2;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <a class="code" href="class_ball_tracking_utility.html#a604af645075c59633c1c783a438d9cbb">m_masterRigCheck</a> = 0;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ; i &lt; 640*480 ; ++i)
<a name="l00058"></a>00058   {
<a name="l00059"></a>00059       <a class="code" href="class_ball_tracking_utility.html#aa84c0576bed25379f1dfc499b4d27d1e">m_depthinm</a>[i] = 0;
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <span class="comment">// all these are separate lists filled by separate calls to interpolate functions</span>
<a name="l00063"></a>00063   <a class="code" href="class_ball_tracking_utility.html#a2b4c65f0cac457cab51bd6fba2cf7f40">m_ballPoints</a>.clear();
<a name="l00064"></a>00064   <a class="code" href="class_ball_tracking_utility.html#a393f4e9bbc17448c4b1b3f596251cd6f">m_momentList</a>.clear();
<a name="l00065"></a>00065   <a class="code" href="class_ball_tracking_utility.html#ac61bffc1ec84985c857b4ed3654b4d70">m_processedBallPts</a>.clear();
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <a class="code" href="class_ball_tracking_utility.html#aaa878876f59419f31c5927b0be8a1bcf">area</a> = <a class="code" href="class_ball_tracking_utility.html#a36fe7e917a5d85acbab96c0f41c8a37c">rectArea</a> = 0.0;
<a name="l00068"></a>00068   <a class="code" href="class_ball_tracking_utility.html#a3f385bd696ea829d5b672a74d6715c60">m_updateTimer</a> = <span class="keyword">new</span> QTimer(<span class="keyword">this</span>);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   connect(<a class="code" href="class_ball_tracking_utility.html#a3f385bd696ea829d5b672a74d6715c60">m_updateTimer</a>, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(<a class="code" href="class_ball_tracking_utility.html#a407c9becd9b22fa1bf68bc1fefc5ea3b">trackBall</a>()));
<a name="l00071"></a>00071   <a class="code" href="class_ball_tracking_utility.html#a3f385bd696ea829d5b672a74d6715c60">m_updateTimer</a>-&gt;start(1);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00077"></a>00077 <span class="comment">//This virtual function is called whenever the widget needs to be painted.</span>
<a name="l00078"></a>00078 <span class="comment">// this is our main drawing routine</span>
<a name="l00079"></a><a class="code" href="class_ball_tracking_utility.html#a407c9becd9b22fa1bf68bc1fefc5ea3b">00079</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a407c9becd9b22fa1bf68bc1fefc5ea3b">BallTrackingUtility::trackBall</a>()
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <a class="code" href="class_kinect_interface.html" title="this class wraps the libfreenect library as a QObject this allows us to use singals...">KinectInterface</a> *kinect=<a class="code" href="class_kinect_interface.html#a13c9a56bd98aaf46329914b7323944c7" title="get the instance of the KinectInterface object this will call the init method of...">KinectInterface::instance</a>();
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     cv::Rect _boundsCheck = kinect-&gt;<a class="code" href="class_kinect_interface.html#ab9fbbdcce13483657ef3ade7722eaba3">getBoxObject</a>();
<a name="l00086"></a>00086 
<a name="l00087"></a>00087  <span class="keywordflow">if</span>(kinect-&gt;<a class="code" href="class_kinect_interface.html#a69b1c94d734bfe5a28491d2fb6f70534">getTrackingFlag</a>())
<a name="l00088"></a>00088  {
<a name="l00089"></a>00089     <span class="keyword">static</span> <span class="keywordtype">int</span> _frameCount = 1;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordtype">float</span> depth = 0.0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     kinect-&gt;<a class="code" href="class_kinect_interface.html#af6c36c376554c5debbbcdf4f8384e32e" title="getDepth buffer as the raw values converted to uint8_t not sure if this will be much...">getDepthRaw</a>(<a class="code" href="class_ball_tracking_utility.html#a756d69c22e183c1e280d49a6d0d58d12">m_bufferDepthRaw</a>,<a class="code" href="class_ball_tracking_utility.html#aa84c0576bed25379f1dfc499b4d27d1e">m_depthinm</a>);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     cv::blur(<a class="code" href="class_ball_tracking_utility.html#a756d69c22e183c1e280d49a6d0d58d12">m_bufferDepthRaw</a>,<a class="code" href="class_ball_tracking_utility.html#a5b8df4677a463c73d2e060d9b4b9a08a">m_bufferDepthRaw1</a>,cv::Size(<a class="code" href="class_ball_tracking_utility.html#ac7b78eb8702e2d12c6e81931127a654c">m_blurSize</a>,<a class="code" href="class_ball_tracking_utility.html#ac7b78eb8702e2d12c6e81931127a654c">m_blurSize</a>));
<a name="l00096"></a>00096     <span class="comment">// to reduce noise, smotthing has been done</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="keywordflow">if</span>(_frameCount == 1)
<a name="l00099"></a>00099     {
<a name="l00100"></a>00100         <a class="code" href="class_ball_tracking_utility.html#a5b8df4677a463c73d2e060d9b4b9a08a">m_bufferDepthRaw1</a>.copyTo(<a class="code" href="class_ball_tracking_utility.html#a56b9750495fcc9113fadac90133cdd37">m_prevBuffer</a>);
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     <a class="code" href="class_ball_tracking_utility.html#a5b8df4677a463c73d2e060d9b4b9a08a">m_bufferDepthRaw1</a>.copyTo(<a class="code" href="class_ball_tracking_utility.html#a244cf2d970c0aa33d137ac2f3ff1bcaf">m_nextBuffer</a>);
<a name="l00104"></a>00104     cv::absdiff(<a class="code" href="class_ball_tracking_utility.html#a244cf2d970c0aa33d137ac2f3ff1bcaf">m_nextBuffer</a>,<a class="code" href="class_ball_tracking_utility.html#a56b9750495fcc9113fadac90133cdd37">m_prevBuffer</a>,<a class="code" href="class_ball_tracking_utility.html#a4f168409ede33e11b820aa92dd327af0">m_diffBuffer</a>);
<a name="l00105"></a>00105     <span class="comment">// has gpu variant // bg subtraction by frame differencing ...GMM method seems good through forums if at all we need</span>
<a name="l00106"></a>00106     <a class="code" href="class_ball_tracking_utility.html#a244cf2d970c0aa33d137ac2f3ff1bcaf">m_nextBuffer</a>.copyTo(<a class="code" href="class_ball_tracking_utility.html#a56b9750495fcc9113fadac90133cdd37">m_prevBuffer</a>);
<a name="l00107"></a>00107     <a class="code" href="class_ball_tracking_utility.html#a4f168409ede33e11b820aa92dd327af0">m_diffBuffer</a>.copyTo(<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     cv::threshold(<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,<a class="code" href="class_ball_tracking_utility.html#aa085251141cc2ba88f8d1dddf761c994">m_binaryLowerThresh</a>,<a class="code" href="class_ball_tracking_utility.html#a3d0956651cff3f02e2e3950bb388b070">m_binaryMaxVal</a>,CV_THRESH_BINARY_INV);
<a name="l00110"></a>00110     cv::Mat element = cv::getStructuringElement(cv::MORPH_ELLIPSE,cv::Size(<a class="code" href="class_ball_tracking_utility.html#a761be0c718feda2661316296421ca1be">m_ellipsesize</a>,<a class="code" href="class_ball_tracking_utility.html#a761be0c718feda2661316296421ca1be">m_ellipsesize</a>));
<a name="l00111"></a>00111     cv::dilate(<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,element,cv::Point(-1,-1),<a class="code" href="class_ball_tracking_utility.html#a0c3be699677a8d5904570a0493494c6c">m_noOfTimesToDialate</a>);
<a name="l00112"></a>00112     cv::erode(<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,<a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>,element,cv::Point(-1,-1),<a class="code" href="class_ball_tracking_utility.html#a0c3be699677a8d5904570a0493494c6c">m_noOfTimesToDialate</a>);
<a name="l00113"></a>00113 
<a name="l00115"></a>00115     cv::Canny( <a class="code" href="class_ball_tracking_utility.html#ac21040d754588a0c36e6d6b3221a2fdd">m_gray</a>, <a class="code" href="class_ball_tracking_utility.html#ae3881b11c9f3ad1955f2cc6d5d2fc67a">canny_output</a>, <a class="code" href="class_ball_tracking_utility.html#a6cb20d610444a7b6b03c82c540ce466e">m_cannyLowerThresh</a>, <a class="code" href="class_ball_tracking_utility.html#a5ad991a7201e1e40485472ed1a84eaa5">m_cannyHigherThresh</a>, 3 ); <span class="comment">// maintiain upper::lower ratio as 2:1 or 3:1 for better results</span>
<a name="l00116"></a>00116                                                                                    <span class="comment">// as suggested by CANNY</span>
<a name="l00118"></a>00118 <span class="comment"></span>    cv::findContours( <a class="code" href="class_ball_tracking_utility.html#ae3881b11c9f3ad1955f2cc6d5d2fc67a">canny_output</a>, <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>, <a class="code" href="class_ball_tracking_utility.html#af247e440c220f4ad537399fbc237a8e7">hierarchy</a>, CV_RETR_LIST, CV_CHAIN_APPROX_SIMPLE, cv::Point(0, 0) ); <span class="comment">// methods to be decided</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>.size(); i++ )
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         <span class="comment">/* cv::drawContours( drawing, contours, i, cv::Scalar(255,0,0),-1, 8, hierarchy, 0, cv::Point() );*/</span> <span class="comment">// -- DEV PURPOSE</span>
<a name="l00124"></a>00124         <a class="code" href="class_ball_tracking_utility.html#aaa878876f59419f31c5927b0be8a1bcf">area</a> = cv::contourArea(<a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span>);
<a name="l00125"></a>00125         cv::RotatedRect r = cv::minAreaRect(<a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i]);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span> (fabs(<a class="code" href="class_ball_tracking_utility.html#aaa878876f59419f31c5927b0be8a1bcf">area</a>) &lt; <a class="code" href="class_ball_tracking_utility.html#a8a392da18b750dd7c4abb4784805d3cd">m_contourAreaThresh</a>) <span class="comment">//my notes: this value is more important in reducing the</span>
<a name="l00128"></a>00128             <span class="comment">//false positives and filters out those false positives by preventing them</span>
<a name="l00129"></a>00129             <span class="comment">// from getting processed further..provide in UI</span>
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131             <span class="keywordflow">continue</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">else</span>
<a name="l00134"></a>00134         {
<a name="l00135"></a>00135             <span class="comment">// do nothing</span>
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138        <span class="keywordflow">if</span> (fabs(fabs(<a class="code" href="class_ball_tracking_utility.html#aaa878876f59419f31c5927b0be8a1bcf">area</a>) - (r.size.width * r.size.height * 3.14 / 4)) &lt; <a class="code" href="class_ball_tracking_utility.html#a85dc05098c8e7f32118acc78bf14ba0d">m_diffAreaThresh</a>)
<a name="l00139"></a>00139        {
<a name="l00140"></a>00140            <a class="code" href="class_ball_tracking_utility.html#a393f4e9bbc17448c4b1b3f596251cd6f">m_momentList</a>.push_back(cv::moments( <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span> ));
<a name="l00141"></a>00141            <span class="keywordtype">float</span> _xMomentsTemp = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(cv::moments( <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span> ).m10/cv::moments( <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span> ).m00);
<a name="l00142"></a>00142            <span class="keywordtype">float</span> _yMomentsTemp = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(cv::moments( <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span> ).m01/cv::moments( <a class="code" href="class_ball_tracking_utility.html#a7ede1459c7eefec281dcbe22aa09a189">contours</a>[i], <span class="keyword">false</span> ).m00);
<a name="l00143"></a>00143            <span class="keywordtype">int</span> depthIndex = (int)((640 - _xMomentsTemp) + (640 * _yMomentsTemp));
<a name="l00144"></a>00144            depth = <a class="code" href="class_ball_tracking_utility.html#aa84c0576bed25379f1dfc499b4d27d1e">m_depthinm</a>[depthIndex] * 0.001;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146            <span class="keywordflow">if</span>(depth != 0)
<a name="l00147"></a>00147            {
<a name="l00148"></a>00148             <span class="keywordflow">if</span>((_xMomentsTemp &gt;= _boundsCheck.x) &amp;&amp; (_xMomentsTemp &lt;= _boundsCheck.x + _boundsCheck.width) &amp;&amp;
<a name="l00149"></a>00149                     (_yMomentsTemp &gt;= _boundsCheck.y) &amp;&amp; (_yMomentsTemp &lt;= _boundsCheck.y + _boundsCheck.height))
<a name="l00150"></a>00150             {
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153                 std::cout&lt;&lt;<span class="stringliteral">&quot;XMoments:&quot;</span>&lt;&lt;_xMomentsTemp&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00154"></a>00154                 <a class="code" href="class_ball_tracking_utility.html#a0319302a51b2b34a48be19d3239ffe13">m_ballPointProcessing</a>-&gt;<a class="code" href="class_ball_points_processing.html#ad87d6c5920186c0a8fec418a8ed3b947">setTrackedPoints</a>(cv::Point3f(_xMomentsTemp,_yMomentsTemp,depth));
<a name="l00155"></a>00155 
<a name="l00156"></a>00156                 <a class="code" href="class_ball_tracking_utility.html#af24fc8bc9ee43d88dd5352b544b4ea2c">convertToWorldFromScreen</a>(_xMomentsTemp,_yMomentsTemp,depth);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158              }
<a name="l00159"></a>00159             }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161           }
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         _frameCount++;
<a name="l00166"></a>00166   }
<a name="l00167"></a>00167  <span class="keywordflow">else</span>
<a name="l00168"></a>00168  {
<a name="l00169"></a>00169      <span class="comment">// tracking not yet started...do nothing</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172  }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00178"></a><a class="code" href="class_ball_tracking_utility.html#aac96b6d5eab8cddb4539b13b757f707a">00178</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#aac96b6d5eab8cddb4539b13b757f707a" title="this method is called every time a mouse is moved">BallTrackingUtility::mouseMoveEvent</a> ( QMouseEvent * _event)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     Q_UNUSED(_event);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00185"></a><a class="code" href="class_ball_tracking_utility.html#ac9fcbd33f96ae359e125b7a7e336917e">00185</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#ac9fcbd33f96ae359e125b7a7e336917e" title="this method is called everytime the mouse button is pressed inherited from QObject...">BallTrackingUtility::mousePressEvent</a> (QMouseEvent * _event )
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187     Q_UNUSED(_event);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00192"></a><a class="code" href="class_ball_tracking_utility.html#a34fcba26407c28109a86672914fef409">00192</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a34fcba26407c28109a86672914fef409" title="this method is called everytime the mouse button is released inherited from QObject...">BallTrackingUtility::mouseReleaseEvent</a> ( QMouseEvent * _event )
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   <span class="comment">// this event is called when the mouse button is released</span>
<a name="l00195"></a>00195   <span class="comment">// we then set Rotate to false</span>
<a name="l00196"></a>00196   Q_UNUSED(_event);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="class_ball_tracking_utility.html#a54e21321a40e6d186198d56f8b7f8c91">00200</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a54e21321a40e6d186198d56f8b7f8c91" title="called when the timer is triggered">BallTrackingUtility::timerEvent</a>( QTimerEvent *_event )
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     Q_UNUSED(_event);
<a name="l00203"></a>00203     <span class="comment">// re-draw GL</span>
<a name="l00204"></a>00204     <span class="comment">//updateGL();</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <a class="code" href="class_ball_tracking_utility.html#a407c9becd9b22fa1bf68bc1fefc5ea3b">trackBall</a>();
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="class_ball_tracking_utility.html#af24fc8bc9ee43d88dd5352b544b4ea2c">00210</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#af24fc8bc9ee43d88dd5352b544b4ea2c">BallTrackingUtility::convertToWorldFromScreen</a>(<span class="keywordtype">float</span> _iScreen, <span class="keywordtype">float</span> _jScreen, <span class="keywordtype">float</span> _zDepth)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordtype">float</span> x = (_iScreen/640 - 0.5) * _zDepth * 1.111467f;
<a name="l00215"></a>00215     <span class="keywordtype">float</span> y = (0.5 - _jScreen/480) * _zDepth * 0.833599f;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217      <a class="code" href="class_ball_tracking_utility.html#a2b4c65f0cac457cab51bd6fba2cf7f40">m_ballPoints</a>.push_back(cv::Point3f(-(y),(1 - _zDepth),-x));
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="class_ball_tracking_utility.html#af2b28aa38b09bf0d35913b2ad8799258">00223</a> <a class="code" href="class_ball_tracking_utility.html#af2b28aa38b09bf0d35913b2ad8799258">BallTrackingUtility::~BallTrackingUtility</a>()
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="class_ball_tracking_utility.html#a328ad6638e601fc6df993eb0a826fdce">00231</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a328ad6638e601fc6df993eb0a826fdce">BallTrackingUtility::setBinaryLowerThresh</a>(<span class="keywordtype">double</span> _lowerThresh)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <a class="code" href="class_ball_tracking_utility.html#aa085251141cc2ba88f8d1dddf761c994">m_binaryLowerThresh</a> = _lowerThresh;
<a name="l00234"></a>00234     <span class="comment">//updateGL();</span>
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="class_ball_tracking_utility.html#a91dcd17fbf714a33fc183651dadecfb9">00237</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a91dcd17fbf714a33fc183651dadecfb9">BallTrackingUtility::setStructuringElementSize</a>(<span class="keywordtype">int</span> _size)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     <a class="code" href="class_ball_tracking_utility.html#a761be0c718feda2661316296421ca1be">m_ellipsesize</a> = _size;
<a name="l00240"></a>00240     <span class="comment">//updateGL();</span>
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="class_ball_tracking_utility.html#a4c0d995dd9c533b1e128e43ac41a3bfb">00243</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a4c0d995dd9c533b1e128e43ac41a3bfb">BallTrackingUtility::setBlurSize</a>(<span class="keywordtype">int</span> _size)
<a name="l00244"></a>00244 {
<a name="l00245"></a>00245     <a class="code" href="class_ball_tracking_utility.html#ac7b78eb8702e2d12c6e81931127a654c">m_blurSize</a> = _size;
<a name="l00246"></a>00246     <span class="comment">//updateGL();</span>
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="class_ball_tracking_utility.html#a1c0dc00fc85b6cd57484238a927dba08">00249</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a1c0dc00fc85b6cd57484238a927dba08">BallTrackingUtility::setCannyLowerThresh</a>(<span class="keywordtype">double</span> _lowerThresh)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="class_ball_tracking_utility.html#a6cb20d610444a7b6b03c82c540ce466e">m_cannyLowerThresh</a> = _lowerThresh;
<a name="l00252"></a>00252     <span class="comment">//updateGL();</span>
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="class_ball_tracking_utility.html#a67d879576bd95b392f2658406e51a054">00256</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a67d879576bd95b392f2658406e51a054">BallTrackingUtility::setCannyHigherThresh</a>(<span class="keywordtype">double</span> _higherThresh)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     <a class="code" href="class_ball_tracking_utility.html#a5ad991a7201e1e40485472ed1a84eaa5">m_cannyHigherThresh</a> = _higherThresh;
<a name="l00259"></a>00259     <span class="comment">//updateGL();</span>
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="class_ball_tracking_utility.html#a33b932006f812cedbd27c893216c4594">00263</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a33b932006f812cedbd27c893216c4594">BallTrackingUtility::setNumerOfDialtions</a>(<span class="keywordtype">int</span> _numberOfDialtions)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265     <a class="code" href="class_ball_tracking_utility.html#a0c3be699677a8d5904570a0493494c6c">m_noOfTimesToDialate</a> = _numberOfDialtions;
<a name="l00266"></a>00266     <span class="comment">//updateGL();</span>
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="class_ball_tracking_utility.html#a4fe623790af4a6ae72384d6c3cfea415">00269</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a4fe623790af4a6ae72384d6c3cfea415">BallTrackingUtility::setContourAreaThresh</a>(<span class="keywordtype">double</span> _contourAreaThresh)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271     <a class="code" href="class_ball_tracking_utility.html#a8a392da18b750dd7c4abb4784805d3cd">m_contourAreaThresh</a> = _contourAreaThresh;
<a name="l00272"></a>00272     <span class="comment">//updateGL();</span>
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="class_ball_tracking_utility.html#a185c9fbf72aef6b109c7bb2d42fde87d">00275</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a185c9fbf72aef6b109c7bb2d42fde87d">BallTrackingUtility::setDifferenceInAreaThresh</a>(<span class="keywordtype">double</span> _diffAreaThresh)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     <a class="code" href="class_ball_tracking_utility.html#a85dc05098c8e7f32118acc78bf14ba0d">m_diffAreaThresh</a> = _diffAreaThresh;
<a name="l00278"></a>00278     <span class="comment">//updateGL();</span>
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="class_ball_tracking_utility.html#a4ef9940ee173c3e51ddf97a0c050d256">00281</a> <span class="keywordtype">void</span> <a class="code" href="class_ball_tracking_utility.html#a4ef9940ee173c3e51ddf97a0c050d256">BallTrackingUtility::setMasterRigCheck</a>(<span class="keywordtype">int</span> _masterRigCheck)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <a class="code" href="class_ball_tracking_utility.html#a604af645075c59633c1c783a438d9cbb">m_masterRigCheck</a> = _masterRigCheck;
<a name="l00284"></a>00284     <span class="comment">//updateGL();</span>
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 16 Aug 2013 for KINECT STATS GENERATOR FOR SPORTS VISUALISATION by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
